$(function() {
	var settings = {
		position:  'normal',
		rotate:    'right',
		translate: 'normal',
		scale:     'normal'
	}

	var state = {
		cmdPressed:  false,
		ctrlPressed: false
	}

	var cmdKeys = [224, 17, 91, 93]

	init()

	function init() {
		initPosition()
		initRotate()
		initTranslate()
		initScale()
	}

	function initPosition() {
		var position = $('#artwork').attr('data-position')

		if (position) {
			settings.position = position
		}
	}

	function initRotate() {
		var rotate = $('#artwork').attr('data-rotate')

		if (rotate) {
			settings.rotate = rotate
		}
	}

	function initTranslate() {
		var translate = $('#artwork').attr('data-translate')

		if (translate) {
			settings.translate = translate
		}
	}

	function initScale() {
		var scale = $('#artwork').attr('data-scale')

		if (scale) {
			settings.scale = scale
		}
	}

	function getPathFromUrl(url) {
		return url.split('?')[0]
	}

	function getURLParameter(name) {
	  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
	}

	function random() {
		return Math.random()
	}

	function randomPosition(r) {
		if (settings.position == 'normal') {
			var random = Math.floor(r * (85 - 0) + 0)
		} else if (settings.position == 'small') {
			var random = Math.floor(r * (30 - 0) + 0)
		} else if (settings.position == 'large') {
			var random = Math.floor(r * (90 - 0) + 0)
		}

		return random + '%'
	}

	function randomRotate(r) {
		if (settings.rotate == 'right') {
			var random = Math.floor(r * 4) * 90
		} else {
			var random = r * 4 * 90
		}

		return 'rotate(' + random + 'deg)'
	}

	function randomTranslate(r, a) {
		if (settings.translate == 'normal') {
			var random = Math.floor(r * (60 - 0) + 0)
		} else if (settings.translate == 'small') {
			var random = Math.floor(r * (30 - 0) + 0)
		} else if (settings.translate == 'large') {
			var random = Math.floor(r * (100 - 0) + 0)
		}

		return 'translate' + a.toUpperCase() + '(' + random + '%)'
	}

	function randomScale(r) {
		if (settings.scale == 'normal') {
			var random = Math.floor(r * (16 - 6) + 6) / 10
		} else if (settings.scale == 'small') {
			var random = Math.floor(r * (12 - 4) + 4) / 10
		} else if (settings.scale == 'large') {
			var random = Math.floor(r * (20 - 8) + 8) / 10
		}

		return 'scale(' + random + ')'
	}

	function randomTransform(r3, r4, r5, r6) {
		return randomRotate(r3) + randomTranslate(r4, 'X') + randomTranslate(r5, 'Y') + randomScale(r6)
	}

	function randomizeElement(r1, r2, r3, r4, r5, r6, element) {
		var styles = {
			left:      randomPosition(r1),
			top:       randomPosition(r2),
			transform: randomTransform(r3, r4, r5, r6)
		}

		$(element).css(styles)
	}

	function randomizeArtwork() {
		$('div.normalize, a.save').removeClass('original')

		var randomArtworkData = []
		var queryString = ''

		$('.rectangle').each(function() {
			var r1 = random()
			var r2 = random()
			var r3 = random()
			var r4 = random()
			var r5 = random()
			var r6 = random()

			randomizeElement(r1, r2, r3, r4, r5, r6, this)

			var id = $(this).attr('id')
			var queryStringPart = id + '=' + r1 + '+' + r2 + '+' + r3 + '+' + r4 + '+' + r5 + '+' + r6

			randomArtworkData.push(queryStringPart)
		})

		randomArtworkData.map(function(v, i) {
			if (i == 0) {
				queryString = '?' + v
			} else {
				queryString += '&' + v
			}
		})

		window.history.pushState('', document.title, getPathFromUrl(window.location.href) + queryString)
		updateShareUrl()

		ga('send', {
		  hitType: 'event',
		  eventCategory: getPathFromUrl(window.location.href),
		  eventAction: 'randomize',
			eventLabel: window.location.href
		})
	}

	function randomizeArtworkFromParams() {
		$('div.normalize, a.save').removeClass('original')

		$('.rectangle').each(function() {
			var params = getURLParameter($(this).attr('id')).split(' ')

			console.log(getURLParameter($(this).attr('id')).split(' '))

			var r1 = params[1-1]
			var r2 = params[2-1]
			var r3 = params[3-1]
			var r4 = params[4-1]
			var r5 = params[5-1]
			var r6 = params[6-1]

			randomizeElement(r1, r2, r3, r4, r5, r6, this)
		})

		updateShareUrl()
	}

	function normalizeArtwork() {
		$('div.normalize, a.save').addClass('original')

		$('.rectangle').each(function() {
			$(this).attr('style', '')
		})

		window.history.pushState('', document.title, getPathFromUrl(window.location.href))
		updateShareUrl()

		ga('send', {
			hitType: 'event',
			eventCategory: getPathFromUrl(window.location.href),
			eventAction: 'normalize',
			eventLabel: window.location.href
		})
	}

	function updateShareUrl() {
		var shareURL = encodeURIComponent(window.location.href)
		var saveEl = $('.save')
		$('#share').attr('data-url', window.location.href)
		saveEl.attr('href', saveEl.attr('data-template') + shareURL)
		initSocialLikes()
	}

	function initSocialLikes() {
		$('.social-likes').socialLikes({
			url: window.location.href
		})
	}

	$('.figures, .random').click(function() {
		randomizeArtwork()
	})

	$('.normalize').click(function() {
		normalizeArtwork()
	})

	document.onkeydown = function(e) {
		if (cmdKeys.includes(e.keyCode)) {
			state.cmdPressed = true
		}

		if (e.ctrlKey) {
			state.ctrlPressed = true
		}

		if (state.cmdPressed == false && state.ctrlPressed == false) {
			if (e.keyCode == 27) {
				normalizeArtwork()
			}

			if (e.keyCode == 82) {
				randomizeArtwork()
			}
		}
	}

	document.onkeyup = function(e) {
		if (cmdKeys.includes(e.keyCode)) {
			state.cmdPressed = false
		}

		if (!e.ctrlKey) {
			state.ctrlPressed = false
		}
	}

  if (window.location.search) {
		randomizeArtworkFromParams()
	}

	$(window).on('popstate', function (e) {
    var state = e.originalEvent.state

    if (state !== null) {
			if (window.location.search) {
				randomizeArtworkFromParams()
			}
    }
	})

	// var artwork1Animation = [
	// 	[
	// 		["0.6494791163968889", "0.05358797654056202", "0.8329051078316061", "0.8548776778245881", "0.20367310042436082", "0.8806571389419504"],
	// 		["0.744467278597496", "0.20693437501018952", "0.955761181928257", "0.607995992965541", "0.7946366821324269", "0.5960428892483369"],
	// 		["0.3158869133764355", "0.5607022960386681", "0.9019650621667148", "0.3983302041372079", "0.5979188838747531", "0.7951390349110881"],
	// 		["0.24050892297927362", "0.11241505388212403", "0.4376438495371222", "0.12712947362543559", "0.3472298479672751", "0.7156123524828577"],
	// 		["0.3529759673021773", "0.9841042346258311", "0.789064386188661", "0.7579412428754453", "0.4252929722920078", "0.18817442580685206"],
	// 		["0.8091461741097581", "0.07174052754402904", "0.9530484026161377", "0.8485311233452759", "0.3296956028776994", "0.2226180718430797"],
	// 		["0.14708474142465877", "0.553539439709307", "0.5740335863378643", "0.20980163876772195", "0.5681122470270943", "0.24850247845381923"],
	// 		["0.6904828563042982", "0.6942730841104678", "0.20596923459551242", "0.3289206373693869", "0.19661296035925058", "0.8300688180079088"],
	// 		["0.8889755289312637", "0.06315433770251988", "0.5512940716686603", "0.11957712503825646", "0.4072458032655706", "0.8610618816177051"]
	// 	], [
	// 		["0.13881594830387733", "0.6602669139040527", "0.7140158499101623", "0.7893407639070018", "0.9596070773438921", "0.11339772376547819"],
	// 		["0.8598585455873402", "0.3435610112749792", "0.94560555670315", "0.6347429857127509", "0.45505776951714516", "0.09426006206789728"],
	// 		["0.12657862439014322", "0.5724522411660007", "0.952898918901655", "0.43739713005208114", "0.6304622977608925", "0.44825395908575993"],
	// 		["0.1313954433104334", "0.7658828769070407", "0.175676458315549", "0.700663247325588", "0.8106955639466444", "0.23469059375313628"],
	// 		["0.7325989374144521", "0.17188246792529527", "0.9739537876909035", "0.7312571031221933", "0.3711024397595335", "0.8972257021667276"],
	// 		["0.6330759075275243", "0.8727384978717243", "0.6118742682319427", "0.8421654852384144", "0.5551399828615251", "0.08846970128909337"],
	// 		["0.9166190232810734", "0.40742177529863044", "0.27591625688798116", "0.5108965552663745", "0.20845782463250995", "0.23175161376409226"],
	// 		["0.7300938124506671", "0.1705685641378123", "0.1308729544149403", "0.2408003090891242", "0.11977326467913585", "0.8801805935827915"],
	// 		["0.31294842357711405", "0.28241227539609803", "0.09831609227611815", "0.7183124282802174", "0.3830671648041444", "0.5403005932861231"]
	// 	], [
	// 		["0.5930050857736775", "0.04643356010609523", "0.08475570315817516", "0.7160700150546899", "0.4593092417323805", "0.8266937672500683"],
	// 		["0.5448839884104282", "0.8911734602572756", "0.48233534678335377", "0.4990685113736373", "0.11740146457666034", "0.3639226225581298"],
	// 		["0.3047228050826316", "0.280553507469693", "0.2596028173410905", "0.6053927365308027", "0.35750937506493186", "0.13882620853105232"],
	// 		["0.37701909706772385", "0.0020993049253288376", "0.9513480286489295", "0.24016806008572633", "0.6165598675766077", "0.7301348832259424"],
	// 		["0.5974802331707252", "0.44203776871990064", "0.9107118630143949", "0.4317002262282572", "0.42930125673428443", "0.2807454588240579"],
	// 		["0.23085390172204656", "0.8838951665037045", "0.9282997205067118", "0.23053251743914638", "0.8258220514654073", "0.16881535632445455"],
	// 		["0.9054629287816494", "0.9114281781848559", "0.37629275200130397", "0.3853335178932318", "0.6575681083629599", "0.1667538755982454"],
	// 		["0.10758442721869899", "0.6677127723101177", "0.5675926209822348", "0.8638216302216057", "0.19222818458478508", "0.464576258793691"],
	// 		["0.7478941119317419", "0.607288742506914", "0.009716167081254001", "0.09139660675345396", "0.7679780944156804", "0.47305593126872414"]
	// 	]
	// ]
	//
	// var artwork13Animation = [
	// 	[
	// 		["0.5351096627401719", "0.6423305317741546", "0.30818840397878033", "0.33980437223519777", "0.4610831517832015", "0.3709952530815417"],
	// 		["0.33552617367271176", "0.2808037162573245", "0.9533081041186198", "0.03040693519716764", "0.5323677876601838", "0.5106472951868339"],
	// 		["0.627951065641305", "0.09274077656023927", "0.14888600077949632", "0.7832047604646839", "0.2485017326207788", "0.23426821250368257"]
	// 	], [
	// 		["0.4915535117751153", "0.8735177892823749", "0.9598619261965737", "0.01653957948518836", "0.9490638864705145", "0.5659027543113153"],
	// 		["0.09462910701944405", "0.18983240899235843", "0.42861254024334006", "0.12679805463603544", "0.7346394318447416", "0.15383195422852647"],
	// 		["0.38237621960883117", "0.586029513318238", "0.4309981713562403", "0.8048148018638392", "0.22971100820327894", "0.7814567264195806"]
	// 	], [
	// 		["0.5585178174076026", "0.4154702701675219", "0.0321210319728078", "0.3311422760752558", "0.11363923468532855", "0.8376350960590944"],
	// 		["0.465916427003354", "0.6000496120425862", "0.9812143845177868", "0.38644480639431045", "0.02114399082598073", "0.19537465988626668"],
	// 		["0.9029706442962986", "0.00416896135342637", "0.43800683718104927", "0.48674429200189895", "0.16893385353304446", "0.1680243605271936"]
	// 	]
	// ]
	//
	// var artwork14Animation = [
	// 	[
	// 		["0.41336272994098167", "0.3718246458458525", "0.1369471005758145", "0.8775403656066676", "0.5532633441039891", "0.30990796652046293"],
	// 		["0.6319008016000329", "0.16237612665363987", "0.9727644127912933", "0.7510497516424133", "0.7279547507068793", "0.1952463716090751"],
	// 		["0.47709786988545355", "0.7140751543374437", "0.7046390294124358", "0.9792560359757354", "0.7320105359582392", "0.7790249591485625"],
	// 		["0.27659467329108", "0.4938012398356908", "0.9628193636860372", "0.915278246934613", "0.35694901606964735", "0.7932737304517574"],
	// 		["0.9657602964386602", "0.4633310613942818", "0.6154113838132411", "0.8398492997226081", "0.09630991601849304", "0.03442243143381907"],
	// 		["0.4128100393333154", "0.846824211116767", "0.0790154238887748", "0.9922844469227816", "0.5800048514058012", "0.800738114825797"],
	// 		["0.12254071556895818", "0.17345105472898514", "0.516696472364718", "0.3486111156699996", "0.7146892693375348", "0.5022316089658405"],
	// 		["0.4188639341771012", "0.22689769691502404", "0.7108687969553844", "0.8244057192912517", "0.7705013101382827", "0.8964315271482353"],
	// 		["0.08128189226548566", "0.6983770819101538", "0.6052756323122099", "0.9299212669374342", "0.2627153611286923", "0.5193410318810205"],
	// 		["0.12227202784825852", "0.06632784579601703", "0.7299566376334381", "0.18694371046540015", "0.21841355532694418", "0.9331743603202725"],
	// 		["0.5783537677194328", "0.6995855657532681", "0.48352195733328496", "0.926841433049076", "0.4574558718342172", "0.29821744384903415"],
	// 		["0.4596977952298582", "0.9794327980472581", "0.9388517607381774", "0.5375612446100322", "0.5144556941289584", "0.891594302234648"],
	// 		["0.37469113012572963", "0.7408514317695019", "0.4314967318884444", "0.4251752215974405", "0.7328334155915928", "0.5378640043360239"],
	// 		["0.9767051721620827", "0.7469311719720337", "0.7798550109491822", "0.25389435340704836", "0.0377644800398218", "0.5590570143491773"],
	// 		["0.0863831697141959", "0.04379516697944763", "0.9614597562920639", "0.985093960032791", "0.39357487509113365", "0.3285680814533587"]
	// 	], [
	// 		["0.3114261977434518", "0.10799226145677054", "0.335937222551538", "0.43498376820415796", "0.5053723731827373", "0.031546715724073415"],
	// 		["0.09245077449194294", "0.6547485121801584", "0.39201412501327426", "0.4501406873977769", "0.1767243296531542", "0.952320358226814"],
	// 		["0.38533039406965086", "0.26893409642335664", "0.6137585343584031", "0.3374308329080007", "0.4180434986748722", "0.8074231420435793"],
	// 		["0.791278683725112", "0.6549712354545991", "0.38997561004443315", "0.24630540143182356", "0.024834672886472342", "0.4840527984272909"],
	// 		["0.4365806565488348", "0.5616299397382376", "0.08716582302291953", "0.7660057825919391", "0.4288458541219182", "0.6350839029134854"],
	// 		["0.09229282937376038", "0.15726133896807504", "0.5095494498237949", "0.0030378578512857413", "0.18530193792748606", "0.3790956326297261"],
	// 		["0.9488020787134572", "0.8844854596451646", "0.6040734429106116", "0.04605286232396355", "0.6588006212275956", "0.4549318377311333"],
	// 		["0.1501418673201036", "0.29940681546262704", "0.6431676720025956", "0.8415592329624912", "0.9475574141944545", "0.20120197936211603"],
	// 		["0.7513250689140476", "0.15932176947570675", "0.22444174318395804", "0.3245228820685522", "0.883335839281308", "0.7237832639804478"],
	// 		["0.8653253330076678", "0.08859790071169926", "0.9756745398783275", "0.4918977434866314", "0.5072897674688555", "0.712105309494715"],
	// 		["0.32111727624673403", "0.87330357214941", "0.9263905745294239", "0.4911739168455376", "0.33933415462608574", "0.2547405814631738"],
	// 		["0.9995509866146255", "0.6159850526752069", "0.5310984666903322", "0.15770885239331234", "0.6605321215611109", "0.6532441562319431"],
	// 		["0.33001767936483883", "0.06764821439465307", "0.8535013330525403", "0.050705822830277913", "0.6959866860096933", "0.10829084769127517"],
	// 		["0.5285294207552611", "0.6438038587236534", "0.6576557976012172", "0.37013642078245645", "0.6875838966141434", "0.4199357172772409"],
	// 		["0.0687177640684915", "0.07347766353561624", "0.5427949981384286", "0.7194384045151392", "0.24884374003204468", "0.15380363380546447"]
	// 	], [
	// 		["0.7679096742368055", "0.774916370417954", "0.7391996071414721", "0.7241075897036229", "0.30534186334838154", "0.903316205070674"],
	// 		["0.31652060007857585", "0.17667523353312076", "0.6544920308644211", "0.9878014942350495", "0.6133916046295624", "0.6221976263455145"],
	// 		["0.36268515942644175", "0.28906372842489114", "0.011974571794142408", "0.7109867457529244", "0.31302125844666606", "0.14785964323553502"],
	// 		["0.7957446546333702", "0.8715955356836962", "0.34246298250969076", "0.7318075606374861", "0.8951346278375507", "0.03597806708534379"],
	// 		["0.6930376837190357", "0.1190325225857094", "0.48599323166711095", "0.9884899136139473", "0.5762795146212845", "0.054423515487781904"],
	// 		["0.07432622744406614", "0.1659983214095211", "0.6346869918669269", "0.6029392608801558", "0.21494260543136634", "0.47706736802125915"],
	// 		["0.6342659758317588", "0.3924427345337127", "0.2814279217480793", "0.9297007228417238", "0.34194084351246756", "0.05506880753477872"],
	// 		["0.25733728023085756", "0.15966702109241004", "0.32915908455908016", "0.08025048605716134", "0.42935986610552535", "0.42703278942378975"],
	// 		["0.5195568198912934", "0.1226665937535123", "0.7610152482549022", "0.23988644673713377", "0.38632465315056863", "0.7742292130975355"],
	// 		["0.7213929706448865", "0.9069106563051885", "0.905223648437032", "0.19468057930492444", "0.1421550832742815", "0.6092538331972011"],
	// 		["0.16802044880940925", "0.7891686960249964", "0.9729314107100906", "0.2401254276358047", "0.6646217847382274", "0.763172183568781"],
	// 		["0.8262624414956996", "0.16250540248893408", "0.8793159089092792", "0.11362812849786152", "0.9458024745762617", "0.19073346543203673"],
	// 		["0.4284862498793469", "0.9381477458244321", "0.9991372229092808", "0.11567663586147181", "0.09009847749884292", "0.8364234127034738"],
	// 		["0.21338185142013377", "0.6829737789690011", "0.4907367205353732", "0.44376127524155096", "0.7303597124995229", "0.18222792726883807"],
	// 		["0.02135921176288713", "0.5265839439328048", "0.7127704415570133", "0.9901151445806691", "0.2150075524407844", "0.08571119578134612"]
	// 	]
	// ]
	//
	// var autoplayCount = 0
	//
	// function randomizeArtworkFromArray(dataset) {
	// 	$('.rectangle').each(function(i) {
	// 		var r = dataset[i]
	//
	// 		var r1 = r[0]
	// 		var r2 = r[1]
	// 		var r3 = r[2]
	// 		var r4 = r[3]
	// 		var r5 = r[4]
	// 		var r6 = r[5]
	//
	// 		randomizeElement(r1, r2, r3, r4, r5, r6, this)
	// 	})
	// }
	//
	// function autoplay() {
	// 	if (autoplayCount <= 2) {
	// 		randomizeArtworkFromArray(artwork14Animation[autoplayCount])
	// 		autoplayCount += 1
	// 	} else {
	// 		normalizeArtwork()
	// 	}
	// }
	//
	// setTimeout(autoplay, 1000)
	// setTimeout(autoplay, 3000)
	// setTimeout(autoplay, 5000)
	// setTimeout(autoplay, 7000)

})
